# Install VS Code extensions — runs once
# Extension list generated by chezmoi from .chezmoi.toml.tmpl

$ErrorActionPreference = "Stop"

if (-not (Get-Command code -ErrorAction SilentlyContinue)) {
    Write-Host "VS Code not found — skipping extension installation"
    exit 0
}

$extList = Join-Path $HOME ".config\vscode-extensions"

if (-not (Test-Path $extList)) {
    Write-Host "Warning: Extension list not found at $extList"
    exit 0
}

Write-Host "Installing VS Code extensions..."

# Read extension list and install (skip empty lines and comments)
Get-Content $extList | Where-Object { $_ -and $_ -notmatch '^\s*#' } | ForEach-Object {
    $ext = $_.Trim()
    if ($ext) {
        Write-Host "Installing $ext..."
        code --install-extension $ext --force
        if ($LASTEXITCODE -ne 0) {
            Write-Host "Warning: Failed to install $ext"
        }
    }
}

Write-Host "VS Code extension installation complete"
